<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (version 1.7.0_51) on Thu Apr 17 17:14:51 CST 2014 -->
<title>FollowerResyncConcurrencyTest</title>
<meta name="date" content="2014-04-17">
<link rel="stylesheet" type="text/css" href="../../../../stylesheet.css" title="Style">
</head>
<body>
<script type="text/javascript"><!--
    if (location.href.indexOf('is-external=true') == -1) {
        parent.document.title="FollowerResyncConcurrencyTest";
    }
//-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar_top">
<!--   -->
</a><a href="#skip-navbar_top" title="Skip navigation links"></a><a name="navbar_top_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/FollowerResyncConcurrencyTest.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-files/index-1.html">Index</a></li>
<li><a href="../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../org/apache/zookeeper/test/FLEZeroWeightTest.html" title="class in org.apache.zookeeper.test"><span class="strong">Prev Class</span></a></li>
<li><a href="../../../../org/apache/zookeeper/test/FourLetterWordsQuorumTest.html" title="class in org.apache.zookeeper.test"><span class="strong">Next Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../index.html?org/apache/zookeeper/test/FollowerResyncConcurrencyTest.html" target="_top">Frames</a></li>
<li><a href="FollowerResyncConcurrencyTest.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li><a href="#field_summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor_summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field_detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor_detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_detail">Method</a></li>
</ul>
</div>
<a name="skip-navbar_top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">org.apache.zookeeper.test</div>
<h2 title="Class FollowerResyncConcurrencyTest" class="title">Class FollowerResyncConcurrencyTest</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li>java.lang.Object</li>
<li>
<ul class="inheritance">
<li><a href="../../../../org/apache/zookeeper/ZKTestCase.html" title="class in org.apache.zookeeper">org.apache.zookeeper.ZKTestCase</a></li>
<li>
<ul class="inheritance">
<li>org.apache.zookeeper.test.FollowerResyncConcurrencyTest</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<hr>
<br>
<pre>public class <span class="strong">FollowerResyncConcurrencyTest</span>
extends <a href="../../../../org/apache/zookeeper/ZKTestCase.html" title="class in org.apache.zookeeper">ZKTestCase</a></pre>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- =========== FIELD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="field_summary">
<!--   -->
</a>
<h3>Field Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Field Summary table, listing fields, and an explanation">
<caption><span>Fields</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Field and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static long</code></td>
<td class="colLast"><code><strong><a href="../../../../org/apache/zookeeper/test/FollowerResyncConcurrencyTest.html#CONNECTION_TIMEOUT">CONNECTION_TIMEOUT</a></strong></code>&nbsp;</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="fields_inherited_from_class_org.apache.zookeeper.ZKTestCase">
<!--   -->
</a>
<h3>Fields inherited from class&nbsp;org.apache.zookeeper.<a href="../../../../org/apache/zookeeper/ZKTestCase.html" title="class in org.apache.zookeeper">ZKTestCase</a></h3>
<code><a href="../../../../org/apache/zookeeper/ZKTestCase.html#watchman">watchman</a></code></li>
</ul>
</li>
</ul>
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor_summary">
<!--   -->
</a>
<h3>Constructor Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Constructor Summary table, listing constructors, and an explanation">
<caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colOne" scope="col">Constructor and Description</th>
</tr>
<tr class="altColor">
<td class="colOne"><code><strong><a href="../../../../org/apache/zookeeper/test/FollowerResyncConcurrencyTest.html#FollowerResyncConcurrencyTest()">FollowerResyncConcurrencyTest</a></strong>()</code>&nbsp;</td>
</tr>
</table>
</li>
</ul>
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method_summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span>Methods</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../../org/apache/zookeeper/test/FollowerResyncConcurrencyTest.html#followerResyncCrashTest(boolean)">followerResyncCrashTest</a></strong>(boolean&nbsp;useTxnLogResync)</code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../../org/apache/zookeeper/test/FollowerResyncConcurrencyTest.html#setUp()">setUp</a></strong>()</code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../../org/apache/zookeeper/test/FollowerResyncConcurrencyTest.html#tearDown()">tearDown</a></strong>()</code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../../org/apache/zookeeper/test/FollowerResyncConcurrencyTest.html#testFollowerSendsLastZxid()">testFollowerSendsLastZxid</a></strong>()</code>
<div class="block">Verify that the server is sending the proper zxid.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../../org/apache/zookeeper/test/FollowerResyncConcurrencyTest.html#testFollowerWatcherResync()">testFollowerWatcherResync</a></strong>()</code>
<div class="block">Verify that the server is sending the proper zxid, and as a result
 the watch doesn't fire.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../../org/apache/zookeeper/test/FollowerResyncConcurrencyTest.html#testLaggingFollowerResyncsUnderNewEpoch()">testLaggingFollowerResyncsUnderNewEpoch</a></strong>()</code>
<div class="block">See ZOOKEEPER-1319 - verify that a lagging follwer resyncs correctly
 
 1) start with down quorum
 2) start leader/follower1, add some data
 3) restart leader/follower1
 4) start follower2
 5) verify data consistency across the ensemble</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../../org/apache/zookeeper/test/FollowerResyncConcurrencyTest.html#testResyncByDiffAfterFollowerCrashes()">testResyncByDiffAfterFollowerCrashes</a></strong>()</code>
<div class="block">This test:
 Starts up 3 ZKs.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../../org/apache/zookeeper/test/FollowerResyncConcurrencyTest.html#testResyncBySnapThenDiffAfterFollowerCrashes()">testResyncBySnapThenDiffAfterFollowerCrashes</a></strong>()</code>
<div class="block">See ZOOKEEPER-962.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../../org/apache/zookeeper/test/FollowerResyncConcurrencyTest.html#testResyncByTxnlogThenDiffAfterFollowerCrashes()">testResyncByTxnlogThenDiffAfterFollowerCrashes</a></strong>()</code>
<div class="block">Same as testResyncBySnapThenDiffAfterFollowerCrashes() but we resync
 follower using txnlog</div>
</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="methods_inherited_from_class_java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.Object</h3>
<code>equals, getClass, hashCode, notify, notifyAll, toString, wait, wait, wait</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ============ FIELD DETAIL =========== -->
<ul class="blockList">
<li class="blockList"><a name="field_detail">
<!--   -->
</a>
<h3>Field Detail</h3>
<a name="CONNECTION_TIMEOUT">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>CONNECTION_TIMEOUT</h4>
<pre>public static final&nbsp;long CONNECTION_TIMEOUT</pre>
</li>
</ul>
</li>
</ul>
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor_detail">
<!--   -->
</a>
<h3>Constructor Detail</h3>
<a name="FollowerResyncConcurrencyTest()">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>FollowerResyncConcurrencyTest</h4>
<pre>public&nbsp;FollowerResyncConcurrencyTest()</pre>
</li>
</ul>
</li>
</ul>
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method_detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="setUp()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>setUp</h4>
<pre>public&nbsp;void&nbsp;setUp()
           throws java.lang.Exception</pre>
<dl><dt><span class="strong">Throws:</span></dt>
<dd><code>java.lang.Exception</code></dd></dl>
</li>
</ul>
<a name="tearDown()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>tearDown</h4>
<pre>public&nbsp;void&nbsp;tearDown()
              throws java.lang.Exception</pre>
<dl><dt><span class="strong">Throws:</span></dt>
<dd><code>java.lang.Exception</code></dd></dl>
</li>
</ul>
<a name="testLaggingFollowerResyncsUnderNewEpoch()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>testLaggingFollowerResyncsUnderNewEpoch</h4>
<pre>public&nbsp;void&nbsp;testLaggingFollowerResyncsUnderNewEpoch()
                                             throws java.lang.Exception</pre>
<div class="block">See ZOOKEEPER-1319 - verify that a lagging follwer resyncs correctly
 
 1) start with down quorum
 2) start leader/follower1, add some data
 3) restart leader/follower1
 4) start follower2
 5) verify data consistency across the ensemble</div>
<dl><dt><span class="strong">Throws:</span></dt>
<dd><code>java.lang.Exception</code></dd></dl>
</li>
</ul>
<a name="testResyncBySnapThenDiffAfterFollowerCrashes()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>testResyncBySnapThenDiffAfterFollowerCrashes</h4>
<pre>public&nbsp;void&nbsp;testResyncBySnapThenDiffAfterFollowerCrashes()
                                                  throws java.io.IOException,
                                                         java.lang.InterruptedException,
                                                         <a href="../../../../org/apache/zookeeper/KeeperException.html" title="class in org.apache.zookeeper">KeeperException</a>,
                                                         java.lang.Throwable</pre>
<div class="block">See ZOOKEEPER-962. This tests for one of the bugs hit while fixing this,
 setting the ZXID of the SNAP packet
 Starts up 3 ZKs. Shut down F1, write a node, restart the one that was shut down
 The non-leader ZKs are writing to cluster
 Shut down F1 again
 Restart after sessions are expired, expect to get a snap file
 Shut down, run some transactions through.
 Restart to a diff while transactions are running in leader</div>
<dl><dt><span class="strong">Throws:</span></dt>
<dd><code>java.io.IOException</code></dd>
<dd><code>java.lang.InterruptedException</code></dd>
<dd><code><a href="../../../../org/apache/zookeeper/KeeperException.html" title="class in org.apache.zookeeper">KeeperException</a></code></dd>
<dd><code>java.lang.Throwable</code></dd></dl>
</li>
</ul>
<a name="testResyncByTxnlogThenDiffAfterFollowerCrashes()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>testResyncByTxnlogThenDiffAfterFollowerCrashes</h4>
<pre>public&nbsp;void&nbsp;testResyncByTxnlogThenDiffAfterFollowerCrashes()
                                                    throws java.io.IOException,
                                                           java.lang.InterruptedException,
                                                           <a href="../../../../org/apache/zookeeper/KeeperException.html" title="class in org.apache.zookeeper">KeeperException</a>,
                                                           java.lang.Throwable</pre>
<div class="block">Same as testResyncBySnapThenDiffAfterFollowerCrashes() but we resync
 follower using txnlog</div>
<dl><dt><span class="strong">Throws:</span></dt>
<dd><code>java.io.IOException</code></dd>
<dd><code>java.lang.InterruptedException</code></dd>
<dd><code><a href="../../../../org/apache/zookeeper/KeeperException.html" title="class in org.apache.zookeeper">KeeperException</a></code></dd>
<dd><code>java.lang.Throwable</code></dd></dl>
</li>
</ul>
<a name="followerResyncCrashTest(boolean)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>followerResyncCrashTest</h4>
<pre>public&nbsp;void&nbsp;followerResyncCrashTest(boolean&nbsp;useTxnLogResync)
                             throws java.io.IOException,
                                    java.lang.InterruptedException,
                                    <a href="../../../../org/apache/zookeeper/KeeperException.html" title="class in org.apache.zookeeper">KeeperException</a>,
                                    java.lang.Throwable</pre>
<dl><dt><span class="strong">Throws:</span></dt>
<dd><code>java.io.IOException</code></dd>
<dd><code>java.lang.InterruptedException</code></dd>
<dd><code><a href="../../../../org/apache/zookeeper/KeeperException.html" title="class in org.apache.zookeeper">KeeperException</a></code></dd>
<dd><code>java.lang.Throwable</code></dd></dl>
</li>
</ul>
<a name="testResyncByDiffAfterFollowerCrashes()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>testResyncByDiffAfterFollowerCrashes</h4>
<pre>public&nbsp;void&nbsp;testResyncByDiffAfterFollowerCrashes()
                                          throws java.io.IOException,
                                                 java.lang.InterruptedException,
                                                 <a href="../../../../org/apache/zookeeper/KeeperException.html" title="class in org.apache.zookeeper">KeeperException</a>,
                                                 java.lang.Throwable</pre>
<div class="block">This test:
 Starts up 3 ZKs. The non-leader ZKs are writing to cluster
 Shut down one of the non-leader ZKs.
 Restart after sessions have expired but <500 txns have taken place (get a diff)
 Shut down immediately after restarting, start running separate thread with other transactions
 Restart to a diff while transactions are running in leader


 Before fixes for ZOOKEEPER-962, restarting off of diff could get an inconsistent view of data missing transactions that
 completed during diff syncing. Follower would also be considered "restarted" before all forwarded transactions
 were completely processed, so restarting would cause a snap file with a too-high zxid to be written, and transactions
 would be missed

 This test should pretty reliably catch the failure of restarting the server before all diff messages have been processed,
 however, due to the transient nature of the system it may not catch failures due to concurrent processing of transactions
 during the leader's diff forwarding.</div>
<dl><dt><span class="strong">Throws:</span></dt>
<dd><code>java.io.IOException</code></dd>
<dd><code>java.lang.InterruptedException</code></dd>
<dd><code><a href="../../../../org/apache/zookeeper/KeeperException.html" title="class in org.apache.zookeeper">KeeperException</a></code></dd>
<dd><code>java.lang.Throwable</code></dd></dl>
</li>
</ul>
<a name="testFollowerSendsLastZxid()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>testFollowerSendsLastZxid</h4>
<pre>public&nbsp;void&nbsp;testFollowerSendsLastZxid()
                               throws java.lang.Exception</pre>
<div class="block">Verify that the server is sending the proper zxid. See ZOOKEEPER-1412.</div>
<dl><dt><span class="strong">Throws:</span></dt>
<dd><code>java.lang.Exception</code></dd></dl>
</li>
</ul>
<a name="testFollowerWatcherResync()">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>testFollowerWatcherResync</h4>
<pre>public&nbsp;void&nbsp;testFollowerWatcherResync()
                               throws java.lang.Exception</pre>
<div class="block">Verify that the server is sending the proper zxid, and as a result
 the watch doesn't fire. See ZOOKEEPER-1412.</div>
<dl><dt><span class="strong">Throws:</span></dt>
<dd><code>java.lang.Exception</code></dd></dl>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar_bottom">
<!--   -->
</a><a href="#skip-navbar_bottom" title="Skip navigation links"></a><a name="navbar_bottom_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/FollowerResyncConcurrencyTest.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-files/index-1.html">Index</a></li>
<li><a href="../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../org/apache/zookeeper/test/FLEZeroWeightTest.html" title="class in org.apache.zookeeper.test"><span class="strong">Prev Class</span></a></li>
<li><a href="../../../../org/apache/zookeeper/test/FourLetterWordsQuorumTest.html" title="class in org.apache.zookeeper.test"><span class="strong">Next Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../index.html?org/apache/zookeeper/test/FollowerResyncConcurrencyTest.html" target="_top">Frames</a></li>
<li><a href="FollowerResyncConcurrencyTest.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li><a href="#field_summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor_summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field_detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor_detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_detail">Method</a></li>
</ul>
</div>
<a name="skip-navbar_bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</body>
</html>
